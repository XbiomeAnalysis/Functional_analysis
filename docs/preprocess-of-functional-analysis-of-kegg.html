<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Preprocess of Functional Analysis of KEGG | Functional analysis</title>
  <meta name="description" content="Tutorial for MGS functional analysis" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Preprocess of Functional Analysis of KEGG | Functional analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Tutorial for MGS functional analysis" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Preprocess of Functional Analysis of KEGG | Functional analysis" />
  
  <meta name="twitter:description" content="Tutorial for MGS functional analysis" />
  

<meta name="author" content="Bangzhuo Tong" />


<meta name="date" content="2022-06-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functional-analysis-of-metacyc-database.html"/>
<link rel="next" href="session-info-1.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Function standard analysis workflow</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Functional Analysis Template</a></li>
<li class="chapter" data-level="2" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html"><i class="fa fa-check"></i><b>2</b> Functional Analysis of Metacyc database</a><ul>
<li class="chapter" data-level="2.1" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#environment-setup"><i class="fa fa-check"></i><b>2.1</b> Environment setup</a></li>
<li class="chapter" data-level="2.2" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#load-data"><i class="fa fa-check"></i><b>2.2</b> load data</a></li>
<li class="chapter" data-level="2.3" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#remove-unppaed-pathways"><i class="fa fa-check"></i><b>2.3</b> Remove unppaed pathways</a></li>
<li class="chapter" data-level="2.4" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#plot-beta-diversity"><i class="fa fa-check"></i><b>2.4</b> Plot Beta diversity</a></li>
<li class="chapter" data-level="2.5" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#permanova-test"><i class="fa fa-check"></i><b>2.5</b> Permanova test</a></li>
<li class="chapter" data-level="2.6" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#differential-analysisda"><i class="fa fa-check"></i><b>2.6</b> Differential analysis(DA)</a><ul>
<li class="chapter" data-level="2.6.1" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#preprocess-before-da"><i class="fa fa-check"></i><b>2.6.1</b> Preprocess before DA</a></li>
<li class="chapter" data-level="2.6.2" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#lefse"><i class="fa fa-check"></i><b>2.6.2</b> LefSE</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#bacteria-contributing-to-differential-pathways"><i class="fa fa-check"></i><b>2.7</b> Bacteria contributing to differential pathways</a></li>
<li class="chapter" data-level="2.8" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#plot-bacteria-contribution"><i class="fa fa-check"></i><b>2.8</b> Plot Bacteria Contribution</a></li>
<li class="chapter" data-level="2.9" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#gene-and-ensyme-involed-in-differential-pathways"><i class="fa fa-check"></i><b>2.9</b> Gene and Ensyme involed in differential pathways</a><ul>
<li class="chapter" data-level="2.9.1" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#load-tables-to-mapping-pathway-to-gene-and-enzyme"><i class="fa fa-check"></i><b>2.9.1</b> load tables to mapping pathway to gene and enzyme</a></li>
<li class="chapter" data-level="2.9.2" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#mapping-pathway-to-related-gene-and-reaction"><i class="fa fa-check"></i><b>2.9.2</b> Mapping pathway to related gene and reaction</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#session-info"><i class="fa fa-check"></i><b>2.10</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html"><i class="fa fa-check"></i><b>3</b> Preprocess of Functional Analysis of KEGG</a><ul>
<li class="chapter" data-level="3.1" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html#environment-setup-1"><i class="fa fa-check"></i><b>3.1</b> Environment Setup</a></li>
<li class="chapter" data-level="3.2" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html#process-pipeline-output"><i class="fa fa-check"></i><b>3.2</b> Process pipeline output</a><ul>
<li class="chapter" data-level="3.2.1" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html#merge-data-from-humann2-pipeline-kegg-database"><i class="fa fa-check"></i><b>3.2.1</b> Merge data from humann2 pipeline (Kegg database)</a></li>
<li class="chapter" data-level="3.2.2" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html#remove-unmapped-row-in-merged-profile-file"><i class="fa fa-check"></i><b>3.2.2</b> Remove unmapped row in merged profile file</a></li>
<li class="chapter" data-level="3.2.3" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html#re-scale-total-sum-scale-map-kegg-gene-entries-to-ko-entries"><i class="fa fa-check"></i><b>3.2.3</b> Re-scale (Total Sum Scale) &amp; map kegg gene entries to KO entries</a></li>
<li class="chapter" data-level="3.2.4" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html#use-minpath-to-extract-the-mapping-information-between-knumers-and-kegg-pathways"><i class="fa fa-check"></i><b>3.2.4</b> Use minpath to extract the mapping information between Knumers and KEGG pathways</a></li>
<li class="chapter" data-level="3.2.5" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html#calculate-the-abundance-of-kegg-pathways"><i class="fa fa-check"></i><b>3.2.5</b> Calculate the abundance of Kegg pathways</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="session-info-1.html"><a href="session-info-1.html"><i class="fa fa-check"></i><b>4</b> 3. Session info</a></li>
<li class="chapter" data-level="5" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html"><i class="fa fa-check"></i><b>5</b> Functional Analysis of KEGG</a></li>
<li class="chapter" data-level="6" data-path="environment-setup-2.html"><a href="environment-setup-2.html"><i class="fa fa-check"></i><b>6</b> 1. Environment setup</a></li>
<li class="chapter" data-level="7" data-path="read-in-processed-profile-table-from-script-functional_analysis_kegg_pathway_preprocess.html"><a href="read-in-processed-profile-table-from-script-functional_analysis_kegg_pathway_preprocess.html"><i class="fa fa-check"></i><b>7</b> 2. Read in processed profile table from script Functional_Analysis_Kegg_Pathway_preprocess.Rmd</a></li>
<li class="chapter" data-level="8" data-path="pre-process-pathway-data.html"><a href="pre-process-pathway-data.html"><i class="fa fa-check"></i><b>8</b> 3. Pre-process pathway data</a><ul>
<li class="chapter" data-level="8.1" data-path="pre-process-pathway-data.html"><a href="pre-process-pathway-data.html#remove-the-pathways-whose-abundance-are-0-across-all-samples"><i class="fa fa-check"></i><b>8.1</b> 3.1 Remove the pathways whose abundance are 0 across all samples</a></li>
<li class="chapter" data-level="8.2" data-path="pre-process-pathway-data.html"><a href="pre-process-pathway-data.html#rescale-data"><i class="fa fa-check"></i><b>8.2</b> 3.2 Rescale data</a></li>
<li class="chapter" data-level="8.3" data-path="pre-process-pathway-data.html"><a href="pre-process-pathway-data.html#remove-unammped-entry"><i class="fa fa-check"></i><b>8.3</b> 3.3 Remove UNAMMPED entry</a></li>
<li class="chapter" data-level="8.4" data-path="pre-process-pathway-data.html"><a href="pre-process-pathway-data.html#filter-low-abundance-pathway"><i class="fa fa-check"></i><b>8.4</b> 3.4 Filter low abundance pathway</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="standard-analysis.html"><a href="standard-analysis.html"><i class="fa fa-check"></i><b>9</b> 4. Standard Analysis</a></li>
<li class="chapter" data-level="10" data-path="differential-analysis.html"><a href="differential-analysis.html"><i class="fa fa-check"></i><b>10</b> 5. Differential analysis</a><ul>
<li class="chapter" data-level="10.1" data-path="differential-analysis.html"><a href="differential-analysis.html#filter-low-prevalence-pathway"><i class="fa fa-check"></i><b>10.1</b> 5.1 Filter low prevalence pathway</a></li>
<li class="chapter" data-level="10.2" data-path="differential-analysis.html"><a href="differential-analysis.html#da"><i class="fa fa-check"></i><b>10.2</b> 5.2 DA</a></li>
<li class="chapter" data-level="10.3" data-path="differential-analysis.html"><a href="differential-analysis.html#session-information"><i class="fa fa-check"></i><b>10.3</b> 6. Session information</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="preprocess-of-functional-analysis-of-targetdatabase.html"><a href="preprocess-of-functional-analysis-of-targetdatabase.html"><i class="fa fa-check"></i><b>11</b> Preprocess of Functional Analysis of TargetDatabase</a><ul>
<li class="chapter" data-level="11.1" data-path="preprocess-of-functional-analysis-of-targetdatabase.html"><a href="preprocess-of-functional-analysis-of-targetdatabase.html#preprocess---merge-sample-data"><i class="fa fa-check"></i><b>11.1</b> Preprocess - Merge sample data</a><ul>
<li class="chapter" data-level="11.1.1" data-path="preprocess-of-functional-analysis-of-targetdatabase.html"><a href="preprocess-of-functional-analysis-of-targetdatabase.html#use-script-merge_metaphlan_tables.py-from-humann2-to-merge-all-gene_family-profile-files.-1"><i class="fa fa-check"></i><b>11.1.1</b> Use Script merge_metaphlan_tables.py from humann2 to merge all gene_family profile files.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html"><i class="fa fa-check"></i><b>12</b> Functional Analysis of TargetDatabase</a><ul>
<li class="chapter" data-level="12.1" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#environment-setup-3"><i class="fa fa-check"></i><b>12.1</b> 1. Environment setup</a></li>
<li class="chapter" data-level="12.2" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#card-data"><i class="fa fa-check"></i><b>12.2</b> 2. card data</a><ul>
<li class="chapter" data-level="12.2.1" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#same-as-kegg-pathway-data-we-normalize-data-at-the-begining-of-analysis-to-reduce-the-differences-of-sequencing-depth-across-all-samples."><i class="fa fa-check"></i><b>12.2.1</b> Same as kegg pathway data, we normalize data at the begining of analysis to reduce the differences of sequencing depth across all samples.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#use-card-data-as-example"><i class="fa fa-check"></i><b>12.3</b> Use card data as example:</a><ul>
<li class="chapter" data-level="12.3.1" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#read-in-card-data"><i class="fa fa-check"></i><b>12.3.1</b> 2.1 Read in card data</a></li>
<li class="chapter" data-level="12.3.2" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#split-strain-info"><i class="fa fa-check"></i><b>12.3.2</b> 2.2 Split strain info</a></li>
<li class="chapter" data-level="12.3.3" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#rescale-card-data"><i class="fa fa-check"></i><b>12.3.3</b> 2.3 Rescale card data</a></li>
<li class="chapter" data-level="12.3.4" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#remove-unmapped-row"><i class="fa fa-check"></i><b>12.3.4</b> 2.4 Remove UNMAPPED row</a></li>
<li class="chapter" data-level="12.3.5" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#filter-low-abundance-data"><i class="fa fa-check"></i><b>12.3.5</b> 2.5 Filter low abundance data</a></li>
<li class="chapter" data-level="12.3.6" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#basic-analysis"><i class="fa fa-check"></i><b>12.3.6</b> 2.6 Basic analysis</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#differential-analysis-1"><i class="fa fa-check"></i><b>12.4</b> 2.7 Differential analysis</a><ul>
<li class="chapter" data-level="12.4.1" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#filter-low-prevalence-pathway-1"><i class="fa fa-check"></i><b>12.4.1</b> Filter low prevalence pathway</a></li>
<li class="chapter" data-level="12.4.2" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#da-1"><i class="fa fa-check"></i><b>12.4.2</b> 2.8 DA</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#session-info-2"><i class="fa fa-check"></i><b>12.5</b> 3. Session info</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Functional analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="preprocess-of-functional-analysis-of-kegg" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Preprocess of Functional Analysis of KEGG</h1>
<div id="environment-setup-1" class="section level2">
<h2><span class="header-section-number">3.1</span> Environment Setup</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="preprocess-of-functional-analysis-of-kegg.html#cb23-1"></a><span class="kw">setwd</span>(<span class="st">&#39;/share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Analysis_template/&#39;</span>)</span></code></pre></div>
</div>
<div id="process-pipeline-output" class="section level2">
<h2><span class="header-section-number">3.2</span> Process pipeline output</h2>
<p>Demo data were saved in folder Demo_data:</p>
<ul>
<li><p>Pipeline_Out. Folder containing all samples’ pipeline result.</p></li>
<li><p>metadata.xls. Metadata of samples.</p></li>
</ul>
<div id="merge-data-from-humann2-pipeline-kegg-database" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Merge data from humann2 pipeline (Kegg database)</h3>
<div id="list-folder-structure-of-humann2-pipeline-result." class="section level4">
<h4><span class="header-section-number">3.2.1.1</span> List folder structure of humann2 pipeline result.</h4>
<p>Four files should be included in humann2_kegg folder of each sample:</p>
<ol style="list-style-type: decimal">
<li><p>*_genefamilies.tsv (KEGG gene profile file, rows are gene names consist of SpeciesCode:GeneName, columns are samples, unit of abundance is RPK)</p></li>
<li><p>*.log</p></li>
<li><p>*_pathabundance.tsv</p></li>
<li><p>*_pathcoverage.tsv</p></li>
</ol>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="preprocess-of-functional-analysis-of-kegg.html#cb24-1"></a><span class="ex">tree</span> -L 4 /share/projects/Analytics/analytics/Function_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/Pipeline_Out/14286/</span></code></pre></div>
<pre><code>## /share/projects/Analytics/analytics/Function_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/Pipeline_Out/14286/
## └── humann2_kegg
##     ├── 14286_genefamilies.tsv
##     ├── 14286.log
##     ├── 14286_pathabundance.tsv
##     └── 14286_pathcoverage.tsv
## 
## 1 directory, 4 files</code></pre>
</div>
<div id="use-script-merge_metaphlan_tables.py-from-humann2-to-merge-all-gene_family-profile-files." class="section level4">
<h4><span class="header-section-number">3.2.1.2</span> Use Script merge_metaphlan_tables.py from humann2 to merge all gene_family profile files.</h4>
<p>In this chunk, we merge all *genefamilies.tsv into one file and edit the colnames of the table</p>
<ul>
<li><p>input: <em>genefamilies.tsv, path of all </em>genefamilies.tsv files</p></li>
<li><p>output: file name of merged profile table.</p></li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="preprocess-of-functional-analysis-of-kegg.html#cb26-1"></a><span class="co">## Remove previously merged profile</span></span>
<span id="cb26-2"><a href="preprocess-of-functional-analysis-of-kegg.html#cb26-2"></a></span>
<span id="cb26-3"><a href="preprocess-of-functional-analysis-of-kegg.html#cb26-3"></a><span class="co">#docker run -i --rm -u $(id -u):$(id -g) -v /share/projects/Analytics/analytics/Function_Analysis/Tongbangzhuo/Phase1/Kegg:/in harbor.xbiome.com/xbiome/environments/humann2:2.8.1-2b8c5c3 bash -c &quot;rm /in/Demo_data/merged_profile.tsv&quot;</span></span>
<span id="cb26-4"><a href="preprocess-of-functional-analysis-of-kegg.html#cb26-4"></a></span>
<span id="cb26-5"><a href="preprocess-of-functional-analysis-of-kegg.html#cb26-5"></a><span class="co">## Start merging profile files</span></span>
<span id="cb26-6"><a href="preprocess-of-functional-analysis-of-kegg.html#cb26-6"></a></span>
<span id="cb26-7"><a href="preprocess-of-functional-analysis-of-kegg.html#cb26-7"></a><span class="ex">docker</span> run -i --rm -u <span class="va">$(</span><span class="fu">id</span> -u<span class="va">)</span>:<span class="va">$(</span><span class="fu">id</span> -g<span class="va">)</span> -v /share/projects/Analytics/analytics/Function_Analysis/Tongbangzhuo/Phase1/Kegg:/in harbor.xbiome.com/xbiome/environments/humann2:2.8.1-2b8c5c3 bash -c <span class="st">&quot;merge_metaphlan_tables.py /in/Demo_data/Pipeline_Out/*/humann2_kegg/*genefamilies.tsv &gt; /in/Demo_data/merged_profile.tsv&quot;</span></span>
<span id="cb26-8"><a href="preprocess-of-functional-analysis-of-kegg.html#cb26-8"></a></span>
<span id="cb26-9"><a href="preprocess-of-functional-analysis-of-kegg.html#cb26-9"></a><span class="co">## Remove suffix in sample name</span></span>
<span id="cb26-10"><a href="preprocess-of-functional-analysis-of-kegg.html#cb26-10"></a><span class="fu">sed</span> -i <span class="st">&#39;s#_genefamilies##g&#39;</span> /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged_profile.tsv</span>
<span id="cb26-11"><a href="preprocess-of-functional-analysis-of-kegg.html#cb26-11"></a><span class="fu">sed</span> -i <span class="st">&#39;s$^ID$# Gene Family$g&#39;</span> /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged_profile.tsv</span></code></pre></div>
</div>
<div id="transform-all-species-code-with-species-name-in-merged-profile-file-map-kegg-gene-id-to-ko-entries" class="section level4">
<h4><span class="header-section-number">3.2.1.3</span> Transform all species code with species name in merged profile file &amp; map kegg gene ID to KO entries</h4>
<p>In this chunk, we transform the species code to species names and convert the kegg gene id to K numbers.</p>
<ul>
<li><p>input1: *profile.tsv</p></li>
<li><p>input2: path of kegg database</p></li>
<li><p>output: <em>kegg, renamed profile table. (suffix must be </em>.kegg)</p></li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="preprocess-of-functional-analysis-of-kegg.html#cb27-1"></a><span class="co">## Mapping file prokaryotes.dat.gz was used to map species code to species names and map kegg gene id to K numbers.</span></span>
<span id="cb27-2"><a href="preprocess-of-functional-analysis-of-kegg.html#cb27-2"></a><span class="co">## Version of prokaryotes.dat.gz should be consistent with the version of Kegg database.</span></span>
<span id="cb27-3"><a href="preprocess-of-functional-analysis-of-kegg.html#cb27-3"></a><span class="co">## Note!!!! file name of output must ends with &quot;.kegg&quot;</span></span>
<span id="cb27-4"><a href="preprocess-of-functional-analysis-of-kegg.html#cb27-4"></a></span>
<span id="cb27-5"><a href="preprocess-of-functional-analysis-of-kegg.html#cb27-5"></a><span class="ex">python</span> /share/projects/Analytics/analytics/Function_Analysis/Tongbangzhuo/Phase1/Kegg/Scripts/rename-kegg-gene.py -in /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged_profile.tsv -db /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Scripts/db/ -out /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged.kegg -species 1</span>
<span id="cb27-6"><a href="preprocess-of-functional-analysis-of-kegg.html#cb27-6"></a></span>
<span id="cb27-7"><a href="preprocess-of-functional-analysis-of-kegg.html#cb27-7"></a><span class="fu">tail</span> -n 2 /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged.kegg</span></code></pre></div>
<pre><code>## zpr:ZPR_4648 0.0 0.0 5.8609585979    3.2134754484    0.0 9.130038598 3.937457596 17.7084295999   0.0 0.0
## zpr:ZPR_4648|s_Zunongwangia_profunda 0.0 0.0 5.8609585979    3.2134754484    0.0 9.130038598 3.937457596 17.7084295999   0.0 0.0</code></pre>
</div>
</div>
<div id="remove-unmapped-row-in-merged-profile-file" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Remove unmapped row in merged profile file</h3>
<p>In this chunk, we remove unmapped row from merged profile file.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="preprocess-of-functional-analysis-of-kegg.html#cb29-1"></a><span class="co">## Since unmapped row doesn&#39;t convey any information we need, we remove unmapped row from merged profile file.</span></span>
<span id="cb29-2"><a href="preprocess-of-functional-analysis-of-kegg.html#cb29-2"></a></span>
<span id="cb29-3"><a href="preprocess-of-functional-analysis-of-kegg.html#cb29-3"></a><span class="fu">grep</span> -v <span class="st">&quot;^UNMAPPED&quot;</span> /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged.kegg <span class="op">&gt;</span> /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged_remove_unmapped.txt</span></code></pre></div>
</div>
<div id="re-scale-total-sum-scale-map-kegg-gene-entries-to-ko-entries" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Re-scale (Total Sum Scale) &amp; map kegg gene entries to KO entries</h3>
<p>In this chunk, we re-scale the profile of each feature by divding their RPK value by the column sum (sum of RPK values within one sample).</p>
<ul>
<li><p>input: the *remove_unmapped.txt file from last step</p></li>
<li><p>output1: *knumber.txt, the profile table of all k numbers in all samples</p></li>
<li><p>output2: <em>input, a list including all K numers in </em>knumber.txt</p></li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="preprocess-of-functional-analysis-of-kegg.html#cb30-1"></a><span class="co">## In this chunk we take merged_remove_unmapped.txt from last step as input, re-scale all features abundance into relative abundance (sum to 1). We also extracted the abundance of K numbers and saved in *knumber.txt</span></span>
<span id="cb30-2"><a href="preprocess-of-functional-analysis-of-kegg.html#cb30-2"></a></span>
<span id="cb30-3"><a href="preprocess-of-functional-analysis-of-kegg.html#cb30-3"></a><span class="ex">python</span> /share/projects/Analytics/analytics/Function_Analysis/Tongbangzhuo/Phase1/Kegg/Scripts/reminpath.py -i /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged_remove_unmapped.txt -k /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged_knumber.txt -m /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged.input</span></code></pre></div>
</div>
<div id="use-minpath-to-extract-the-mapping-information-between-knumers-and-kegg-pathways" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Use minpath to extract the mapping information between Knumers and KEGG pathways</h3>
<p>In this chunk, we use minpath to extract the mapping relation between K numers and KEGG pathways and generate <em>report and </em>details for the calculation of pathway abundance.</p>
<ul>
<li><p>input: *input from last step</p></li>
<li><p>output1: *report, report of minpath</p></li>
<li><p>output2: *details, detail of minpath</p></li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="preprocess-of-functional-analysis-of-kegg.html#cb31-1"></a></span>
<span id="cb31-2"><a href="preprocess-of-functional-analysis-of-kegg.html#cb31-2"></a><span class="ex">python</span> /share/work/runtime/softwares/MinPath/MinPath.py -ko /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged.input -report /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged.report -details /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged.details <span class="op">&gt;</span> /dev/null <span class="op">2&gt;&amp;1</span></span></code></pre></div>
</div>
<div id="calculate-the-abundance-of-kegg-pathways" class="section level3">
<h3><span class="header-section-number">3.2.5</span> Calculate the abundance of Kegg pathways</h3>
<p>In this chunk we calculate the abundance of KEGG pathways. Since multiple K numbers may belong to the same Pathway, we provided three methods to calculate the abundance of pathway from multiple K numbers:</p>
<ol style="list-style-type: decimal">
<li><p>Harmonic Mean</p></li>
<li><p>Median</p></li>
<li><p>Average of top 50% abundance KOs</p></li>
</ol>
<ul>
<li><p>input1: *report from last step</p></li>
<li><p>input2: *details from last step</p></li>
<li><p>input3: *remove_unmapped.txt from chunk <code>remove unmapped row</code>, unit for each feature is RPK.</p></li>
<li><p>output: *pathway.txt, pathway profile file</p></li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="preprocess-of-functional-analysis-of-kegg.html#cb32-1"></a><span class="co">## In this chunk, we use the minpath report (stroing the mapping information between KO and Kegg pathway) and abundance table (unit of feature is RPK) of KO to estimate the abundance of pathways.</span></span>
<span id="cb32-2"><a href="preprocess-of-functional-analysis-of-kegg.html#cb32-2"></a><span class="co">## Note: Becasue minpath mapping file doesn&#39;t include the UMAPPED entry, we need to add UMAPPED entry to the output manually after the calcualtion of pathway abundance.</span></span>
<span id="cb32-3"><a href="preprocess-of-functional-analysis-of-kegg.html#cb32-3"></a></span>
<span id="cb32-4"><a href="preprocess-of-functional-analysis-of-kegg.html#cb32-4"></a><span class="ex">python</span> /share/projects/Analytics/analytics/Function_Analysis/Tongbangzhuo/Phase1/Kegg/Scripts/kegg_abundance.py -path /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged.report -detail /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged.details -in  /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged_remove_unmapped.txt -out /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged_pathway.txt</span>
<span id="cb32-5"><a href="preprocess-of-functional-analysis-of-kegg.html#cb32-5"></a></span>
<span id="cb32-6"><a href="preprocess-of-functional-analysis-of-kegg.html#cb32-6"></a><span class="co">## Add UNMAPPED row to pathway abundance table</span></span>
<span id="cb32-7"><a href="preprocess-of-functional-analysis-of-kegg.html#cb32-7"></a></span>
<span id="cb32-8"><a href="preprocess-of-functional-analysis-of-kegg.html#cb32-8"></a><span class="fu">grep</span> <span class="st">&quot;UNMAPPED&quot;</span> /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged.kegg <span class="kw">|</span> <span class="fu">grep</span> -v <span class="st">&quot;|&quot;</span> <span class="op">&gt;&gt;</span> /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged_pathway.txt</span>
<span id="cb32-9"><a href="preprocess-of-functional-analysis-of-kegg.html#cb32-9"></a></span>
<span id="cb32-10"><a href="preprocess-of-functional-analysis-of-kegg.html#cb32-10"></a><span class="co">## Quick view of kegg pathway profile</span></span>
<span id="cb32-11"><a href="preprocess-of-functional-analysis-of-kegg.html#cb32-11"></a><span class="fu">head</span> /share/projects/SOP/Functional_Analysis/Tongbangzhuo/Phase1/Kegg/Demo_data/merged_pathway.txt</span></code></pre></div>
<pre><code>## # Gene Family    14286   14287   14288   14289   14290   14291   14292   14293   14294   14295
## 00010    5947.956833127901   206.4171318373  820.2781166492  3347.7553326125 201.14052381119998  171.59917911649998  1334.4083721097 165.99768445080005  1421.4703949554 0.0
## 00020    3188.38915159045    584.3494875558001   1174.9152938714 4129.5363162696 637.00629415665 622.07045936685 1595.90621966225    594.7157296549999   1335.3594613054997  0.0
## 00030    189.9400101 0.0 67.70359926875  1562.3995269805 21.5439298511   21.7629168057   183.8472359562  52.283541589500004  117.99324261619999  0.0
## 00040    53.318527655100006  33.326521076700004  65.30936012689999   258.9344738527  24.5995484145   0   43.297908892200006  18.725243294600002  0   0.0
## 00051    953.9344640029  125.2205068581  91.036795328    1801.0554231356 34.234599064899996  70.633450268    243.828461326   16.806722689700006  1070.9931901685 0.0
## 00052    530.0746804299  300.271065183   193.8664536295  2191.9950307487 163.3999406518  48.198882973    381.77839881660003  74.449850811    2192.5614262354 0.0
## 00053    0   0   0   0   0   0   0   0   0   0
## 00061    43.728001148500006  0   156.8103154342  563.7285164538  70.5150046695   0   559.1490593607  0   147.3375876432  0.0
## 00071    0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0</code></pre>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functional-analysis-of-metacyc-database.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="session-info-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/XbiomeAnalysis/FunctionAnalysis/blob/main/02-Functional_Analysis_Kegg_Pathway_preprocess.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Function standard analysis workflow.pdf", "Function standard analysis workflow.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
