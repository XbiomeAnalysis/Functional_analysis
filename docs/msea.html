<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 MSEA | Functional analysis</title>
  <meta name="description" content="Tutorial for MGS functional analysis" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 MSEA | Functional analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Tutorial for MGS functional analysis" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 MSEA | Functional analysis" />
  
  <meta name="twitter:description" content="Tutorial for MGS functional analysis" />
  

<meta name="author" content="Bangzhuo Tong" />


<meta name="date" content="2022-07-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functional-analysis-of-targetdatabase.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Function standard analysis workflow</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html"><i class="fa fa-check"></i><b>2</b> Functional Analysis of Metacyc database</a><ul>
<li class="chapter" data-level="2.1" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#environment-setup"><i class="fa fa-check"></i><b>2.1</b> Environment setup</a></li>
<li class="chapter" data-level="2.2" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#load-data"><i class="fa fa-check"></i><b>2.2</b> load data</a></li>
<li class="chapter" data-level="2.3" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#remove-unppaed-pathways"><i class="fa fa-check"></i><b>2.3</b> Remove unppaed pathways</a></li>
<li class="chapter" data-level="2.4" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#plot-beta-diversity"><i class="fa fa-check"></i><b>2.4</b> Plot Beta diversity</a></li>
<li class="chapter" data-level="2.5" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#permanova-test"><i class="fa fa-check"></i><b>2.5</b> Permanova test</a></li>
<li class="chapter" data-level="2.6" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#differential-analysisda"><i class="fa fa-check"></i><b>2.6</b> Differential analysis(DA)</a><ul>
<li class="chapter" data-level="2.6.1" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#preprocess-before-da"><i class="fa fa-check"></i><b>2.6.1</b> Preprocess before DA</a></li>
<li class="chapter" data-level="2.6.2" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#lefse"><i class="fa fa-check"></i><b>2.6.2</b> LefSE</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#bacteria-contributing-to-differential-pathways"><i class="fa fa-check"></i><b>2.7</b> Bacteria contributing to differential pathways</a></li>
<li class="chapter" data-level="2.8" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#plot-bacteria-contribution"><i class="fa fa-check"></i><b>2.8</b> Plot Bacteria Contribution</a></li>
<li class="chapter" data-level="2.9" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#gene-and-ensyme-involed-in-differential-pathways"><i class="fa fa-check"></i><b>2.9</b> Gene and Ensyme involed in differential pathways</a><ul>
<li class="chapter" data-level="2.9.1" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#load-tables-to-mapping-pathway-to-gene-and-enzyme"><i class="fa fa-check"></i><b>2.9.1</b> load tables to mapping pathway to gene and enzyme</a></li>
<li class="chapter" data-level="2.9.2" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#mapping-pathway-to-related-gene-and-reaction"><i class="fa fa-check"></i><b>2.9.2</b> Mapping pathway to related gene and reaction</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="functional-analysis-of-metacyc-database.html"><a href="functional-analysis-of-metacyc-database.html#session-info"><i class="fa fa-check"></i><b>2.10</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html"><i class="fa fa-check"></i><b>3</b> Preprocess of Functional Analysis of KEGG</a><ul>
<li class="chapter" data-level="3.1" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html#environment-setup-1"><i class="fa fa-check"></i><b>3.1</b> Environment Setup</a></li>
<li class="chapter" data-level="3.2" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html#process-pipeline-output"><i class="fa fa-check"></i><b>3.2</b> Process pipeline output</a><ul>
<li class="chapter" data-level="3.2.1" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html#merge-data-from-humann2-pipeline-kegg-database"><i class="fa fa-check"></i><b>3.2.1</b> Merge data from humann2 pipeline (Kegg database)</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="preprocess-of-functional-analysis-of-kegg.html"><a href="preprocess-of-functional-analysis-of-kegg.html#session-info-1"><i class="fa fa-check"></i><b>3.3</b> Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html"><i class="fa fa-check"></i><b>4</b> Functional Analysis of KEGG</a><ul>
<li class="chapter" data-level="4.1" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html#environment-setup-2"><i class="fa fa-check"></i><b>4.1</b> Environment setup</a></li>
<li class="chapter" data-level="4.2" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html#read-in-processed-profile-table-from-script-functional_analysis_kegg_pathway_preprocess.rmd"><i class="fa fa-check"></i><b>4.2</b> Read in processed profile table from script Functional_Analysis_Kegg_Pathway_preprocess.Rmd</a></li>
<li class="chapter" data-level="4.3" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html#pre-process-pathway-data"><i class="fa fa-check"></i><b>4.3</b> Pre-process pathway data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html#remove-the-pathways-whose-abundance-are-0-across-all-samples"><i class="fa fa-check"></i><b>4.3.1</b> Remove the pathways whose abundance are 0 across all samples</a></li>
<li class="chapter" data-level="4.3.2" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html#rescale-data"><i class="fa fa-check"></i><b>4.3.2</b> Rescale data</a></li>
<li class="chapter" data-level="4.3.3" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html#remove-unammped-entry"><i class="fa fa-check"></i><b>4.3.3</b> Remove UNAMMPED entry</a></li>
<li class="chapter" data-level="4.3.4" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html#filter-low-abundance-pathway"><i class="fa fa-check"></i><b>4.3.4</b> Filter low abundance pathway</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html#standard-analysis"><i class="fa fa-check"></i><b>4.4</b> Standard Analysis</a></li>
<li class="chapter" data-level="4.5" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html#differential-analysis"><i class="fa fa-check"></i><b>4.5</b> Differential analysis</a><ul>
<li class="chapter" data-level="4.5.1" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html#filter-low-prevalence-pathway"><i class="fa fa-check"></i><b>4.5.1</b> Filter low prevalence pathway</a></li>
<li class="chapter" data-level="4.5.2" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html#da"><i class="fa fa-check"></i><b>4.5.2</b> DA</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="functional-analysis-of-kegg.html"><a href="functional-analysis-of-kegg.html#session-information"><i class="fa fa-check"></i><b>4.6</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="preprocess-of-functional-analysis-of-targetdatabase.html"><a href="preprocess-of-functional-analysis-of-targetdatabase.html"><i class="fa fa-check"></i><b>5</b> Preprocess of Functional Analysis of TargetDatabase</a><ul>
<li class="chapter" data-level="5.1" data-path="preprocess-of-functional-analysis-of-targetdatabase.html"><a href="preprocess-of-functional-analysis-of-targetdatabase.html#preprocess---merge-sample-data"><i class="fa fa-check"></i><b>5.1</b> Preprocess - Merge sample data</a><ul>
<li class="chapter" data-level="5.1.1" data-path="preprocess-of-functional-analysis-of-targetdatabase.html"><a href="preprocess-of-functional-analysis-of-targetdatabase.html#use-script-merge_metaphlan_tables.py-from-humann2-to-merge-all-gene_family-profile-files.-1"><i class="fa fa-check"></i><b>5.1.1</b> Use Script merge_metaphlan_tables.py from humann2 to merge all gene_family profile files.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html"><i class="fa fa-check"></i><b>6</b> Functional Analysis of TargetDatabase</a><ul>
<li class="chapter" data-level="6.1" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#environment-setup-3"><i class="fa fa-check"></i><b>6.1</b> Environment setup</a></li>
<li class="chapter" data-level="6.2" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#use-card-data-as-example"><i class="fa fa-check"></i><b>6.2</b> Use card data as example</a><ul>
<li class="chapter" data-level="6.2.1" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#read-in-card-data"><i class="fa fa-check"></i><b>6.2.1</b> Read in card data</a></li>
<li class="chapter" data-level="6.2.2" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#split-strain-info"><i class="fa fa-check"></i><b>6.2.2</b> Split strain info</a></li>
<li class="chapter" data-level="6.2.3" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#rescale-card-data"><i class="fa fa-check"></i><b>6.2.3</b> Rescale card data</a></li>
<li class="chapter" data-level="6.2.4" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#remove-unmapped-row"><i class="fa fa-check"></i><b>6.2.4</b> Remove UNMAPPED row</a></li>
<li class="chapter" data-level="6.2.5" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#filter-low-abundance-data"><i class="fa fa-check"></i><b>6.2.5</b> Filter low abundance data</a></li>
<li class="chapter" data-level="6.2.6" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#basic-analysis"><i class="fa fa-check"></i><b>6.2.6</b> Basic analysis</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#differential-analysis-1"><i class="fa fa-check"></i><b>6.3</b> Differential analysis</a><ul>
<li class="chapter" data-level="6.3.1" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#filter-low-prevalence-pathway-1"><i class="fa fa-check"></i><b>6.3.1</b> Filter low prevalence pathway</a></li>
<li class="chapter" data-level="6.3.2" data-path="functional-analysis-of-targetdatabase.html"><a href="functional-analysis-of-targetdatabase.html#da-1"><i class="fa fa-check"></i><b>6.3.2</b> DA</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="msea.html"><a href="msea.html"><i class="fa fa-check"></i><b>7</b> MSEA</a><ul>
<li class="chapter" data-level="7.1" data-path="msea.html"><a href="msea.html#execute-msea-with-python-script-on-server"><i class="fa fa-check"></i><b>7.1</b> Execute MSEA with python script on server</a></li>
<li class="chapter" data-level="7.2" data-path="msea.html"><a href="msea.html#read-in-msea-result"><i class="fa fa-check"></i><b>7.2</b> Read in MSEA result</a></li>
<li class="chapter" data-level="7.3" data-path="msea.html"><a href="msea.html#filter-and-visualize-msea-result"><i class="fa fa-check"></i><b>7.3</b> Filter and Visualize MSEA result</a></li>
<li class="chapter" data-level="7.4" data-path="msea.html"><a href="msea.html#draw-bipartit-graph-to-show-the-relation-between-human-genes-and-microbial-genus-with-ggnet."><i class="fa fa-check"></i><b>7.4</b> Draw bipartit graph to show the relation between human genes and microbial Genus with ggnet.</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Functional analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="msea" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> MSEA</h1>
<p>This is a markdown tutorial for MSEA. To run MSEA, you need to Install MSEA to your default python before running this template. Installation instruction: <a href="https://msea.readthedocs.io/en/latest/quickstart.html#installation" class="uri">https://msea.readthedocs.io/en/latest/quickstart.html#installation</a>.</p>
<p>You can run MSEA when you got genus that you’re interested in (e.g., DA genus), write all genus into one txt file, one genus per line and feed the file to MSEA as input.</p>
<div id="execute-msea-with-python-script-on-server" class="section level2">
<h2><span class="header-section-number">7.1</span> Execute MSEA with python script on server</h2>
<p>You can run MSEA analysis with MSEA_Run.py on server, one required parameters and two optional parameters need to be provided for the script:</p>
<ol style="list-style-type: decimal">
<li>–input (Required), input genus list file for MSEA, one genus per line.<br />
</li>
<li>–output (Optional), output csv file of MSEA result. Default testout.csv<br />
</li>
<li>–PerturbationTimes (Optional), number of perturbation. Fisher’s excat test has bias on group with large number of samples, MSEA uses random sampling to remove the bias. Larger number of perturbation would cause longer runtime. Default 50.<br />
Citation: <a href="https://www.nature.com/articles/s41598-020-78511-y" class="uri">https://www.nature.com/articles/s41598-020-78511-y</a></li>
</ol>
<div class="sourceCode" id="cb87"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb87-1"><a href="msea.html#cb87-1"></a></span>
<span id="cb87-2"><a href="msea.html#cb87-2"></a><span class="ex">/home/tongbangzhuo/Software/miniconda3/bin/python</span> /share/projects/SOP/Functional_Analysis/Tongbangzhuo/MSEA/MSEA_Run.py --input /share/projects/SOP/Functional_Analysis/Tongbangzhuo/MSEA/test_input --output testout.csv --PerturbationTimes 10</span></code></pre></div>
<pre><code>## 
## Reading database file
## 
## Calculating empirical ranks for each set...
## Number of unique microbes: 566
## 
  0%|          | 0/10 [00:00&lt;?, ?it/s]
 10%|█         | 1/10 [00:01&lt;00:10,  1.15s/it]
 20%|██        | 2/10 [00:01&lt;00:07,  1.13it/s]
 30%|███       | 3/10 [00:02&lt;00:05,  1.29it/s]
 40%|████      | 4/10 [00:03&lt;00:04,  1.40it/s]
 50%|█████     | 5/10 [00:03&lt;00:03,  1.46it/s]
 60%|██████    | 6/10 [00:04&lt;00:02,  1.47it/s]
 70%|███████   | 7/10 [00:05&lt;00:02,  1.35it/s]
 80%|████████  | 8/10 [00:05&lt;00:01,  1.43it/s]
 90%|█████████ | 9/10 [00:06&lt;00:00,  1.39it/s]
100%|██████████| 10/10 [00:07&lt;00:00,  1.36it/s]
100%|██████████| 10/10 [00:07&lt;00:00,  1.34it/s]
## 
## Performing MSEA with adjustment
## 
## Showing the head of result table:
##           oddsratio  ...  n_shared
## term                 ...          
## SERPING1  90.909091  ...         5
## IFNAR1    53.333333  ...         4
## SP7       27.586207  ...         4
## XIAP      43.478261  ...         5
## IL11      40.000000  ...         3
## 
## [5 rows x 7 columns]
## 
## Finished !!</code></pre>
</div>
<div id="read-in-msea-result" class="section level2">
<h2><span class="header-section-number">7.2</span> Read in MSEA result</h2>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="msea.html#cb89-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb89-2"><a href="msea.html#cb89-2"></a><span class="kw">library</span>(magrittr)</span>
<span id="cb89-3"><a href="msea.html#cb89-3"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb89-4"><a href="msea.html#cb89-4"></a><span class="kw">library</span>(ggbipart)</span>
<span id="cb89-5"><a href="msea.html#cb89-5"></a><span class="kw">library</span>(stringr)</span>
<span id="cb89-6"><a href="msea.html#cb89-6"></a><span class="kw">library</span>(tibble)</span>
<span id="cb89-7"><a href="msea.html#cb89-7"></a><span class="kw">library</span>(wesanderson)</span>
<span id="cb89-8"><a href="msea.html#cb89-8"></a></span>
<span id="cb89-9"><a href="msea.html#cb89-9"></a>MSEA_res =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;/share/projects/SOP/Functional_Analysis/Tongbangzhuo/MSEA/testout.csv&#39;</span>, <span class="dt">sep =</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>)</span>
<span id="cb89-10"><a href="msea.html#cb89-10"></a><span class="kw">head</span>(MSEA_res, <span class="dt">n=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>##       term oddsratio       pvalue       qvalue    zscore combined_score                                                           shared n_shared
## 1    FOLH1 160.00000 3.554225e-07 6.262868e-05 -5.371776       79.77066             [&#39;Sodalis&#39;, &#39;Pseudomonas&#39;, &#39;Salmonella&#39;, &#39;Azomonas&#39;]        4
## 2 SERPING1  90.90909 1.148926e-07 6.262868e-05 -3.721529       59.46731 [&#39;Borrelia&#39;, &#39;Sodalis&#39;, &#39;Azomonas&#39;, &#39;Pseudomonas&#39;, &#39;Salmonella&#39;]        5
## 3  CYP24A1  80.00000 2.714435e-06 7.609163e-05 -3.749628       48.05871             [&#39;Sodalis&#39;, &#39;Pseudomonas&#39;, &#39;Salmonella&#39;, &#39;Azomonas&#39;]        4</code></pre>
<p>As the table shown above, MSEA result has 8 columns:</p>
<ol style="list-style-type: decimal">
<li>term, human gene names.<br />
</li>
<li>oddsratio. Odds ratio (Effect size) of the association between human gene and microbial Genus.<br />
</li>
<li>pvalue. p value of Fisher’s exact test.<br />
</li>
<li>qvalue. q value of Fisher’s exact test. FDR Benjamini-Hochberg correction applied.<br />
</li>
<li>zscore. z-score measuring the deviation in expected ranks.<br />
</li>
<li>combined_score. <span class="math inline">\(c = log_{10}(p)*z\)</span>.<br />
</li>
<li>shared. Genus associated with the human gene.<br />
</li>
<li>n_shared. Number of genus associated with the human gene.</li>
</ol>
</div>
<div id="filter-and-visualize-msea-result" class="section level2">
<h2><span class="header-section-number">7.3</span> Filter and Visualize MSEA result</h2>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="msea.html#cb91-1"></a><span class="co">## Filter MSEA result with qvalue</span></span>
<span id="cb91-2"><a href="msea.html#cb91-2"></a>MSEA_res <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">filter</span>(qvalue <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)</span>
<span id="cb91-3"><a href="msea.html#cb91-3"></a></span>
<span id="cb91-4"><a href="msea.html#cb91-4"></a></span>
<span id="cb91-5"><a href="msea.html#cb91-5"></a><span class="co">## Draw bipartite with top 10 combined_score human genes</span></span>
<span id="cb91-6"><a href="msea.html#cb91-6"></a></span>
<span id="cb91-7"><a href="msea.html#cb91-7"></a><span class="co">## Define data transforming function</span></span>
<span id="cb91-8"><a href="msea.html#cb91-8"></a>Transform_data &lt;-<span class="st"> </span><span class="cf">function</span>(df){</span>
<span id="cb91-9"><a href="msea.html#cb91-9"></a>  All_Genus_in_res &lt;-<span class="st"> </span>df<span class="op">$</span>shared <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove_all</span>(<span class="st">&#39;</span><span class="ch">\\</span><span class="st">[&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove_all</span>(<span class="st">&#39;</span><span class="ch">\\</span><span class="st">]&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove_all</span>(<span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_split</span>(<span class="st">&#39;, &#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>()</span>
<span id="cb91-10"><a href="msea.html#cb91-10"></a>  lst &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb91-11"><a href="msea.html#cb91-11"></a>  <span class="cf">for</span> (i <span class="cf">in</span> All_Genus_in_res){</span>
<span id="cb91-12"><a href="msea.html#cb91-12"></a>    count_vec &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb91-13"><a href="msea.html#cb91-13"></a>    <span class="cf">for</span> (j <span class="cf">in</span> (<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(df))){</span>
<span id="cb91-14"><a href="msea.html#cb91-14"></a>      target_string =<span class="st"> </span>df[j,<span class="st">&#39;shared&#39;</span>]  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove_all</span>(<span class="st">&#39;</span><span class="ch">\\</span><span class="st">[&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove_all</span>(<span class="st">&#39;</span><span class="ch">\\</span><span class="st">]&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove_all</span>(<span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_split</span>(<span class="st">&#39;, &#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>()</span>
<span id="cb91-15"><a href="msea.html#cb91-15"></a>      count =<span class="st"> </span><span class="kw">sum</span>(i <span class="op">==</span><span class="st"> </span>target_string)</span>
<span id="cb91-16"><a href="msea.html#cb91-16"></a>      count_vec &lt;-<span class="st"> </span><span class="kw">c</span>(count_vec, count)</span>
<span id="cb91-17"><a href="msea.html#cb91-17"></a>    }</span>
<span id="cb91-18"><a href="msea.html#cb91-18"></a>    lst[[i]] &lt;-<span class="st"> </span>count_vec</span>
<span id="cb91-19"><a href="msea.html#cb91-19"></a>  }</span>
<span id="cb91-20"><a href="msea.html#cb91-20"></a>  bipartite_tbl &lt;-<span class="st"> </span><span class="kw">cbind</span>(Top_MSEA_res, <span class="kw">as.data.frame</span>(lst)) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(term, <span class="kw">all_of</span>(All_Genus_in_res)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">column_to_rownames</span>(<span class="st">&#39;term&#39;</span>)</span>
<span id="cb91-21"><a href="msea.html#cb91-21"></a>  <span class="kw">return</span>(bipartite_tbl)</span>
<span id="cb91-22"><a href="msea.html#cb91-22"></a>}</span>
<span id="cb91-23"><a href="msea.html#cb91-23"></a></span>
<span id="cb91-24"><a href="msea.html#cb91-24"></a><span class="co">## Select top 10 human genes</span></span>
<span id="cb91-25"><a href="msea.html#cb91-25"></a>Top_MSEA_res &lt;-<span class="st"> </span>MSEA_res[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,]</span></code></pre></div>
</div>
<div id="draw-bipartit-graph-to-show-the-relation-between-human-genes-and-microbial-genus-with-ggnet." class="section level2">
<h2><span class="header-section-number">7.4</span> Draw bipartit graph to show the relation between human genes and microbial Genus with ggnet.</h2>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="msea.html#cb92-1"></a><span class="co">## Generate data for bipartit graph</span></span>
<span id="cb92-2"><a href="msea.html#cb92-2"></a>bipartite_tbl &lt;-<span class="st"> </span><span class="kw">Transform_data</span>(Top_MSEA_res)</span>
<span id="cb92-3"><a href="msea.html#cb92-3"></a></span>
<span id="cb92-4"><a href="msea.html#cb92-4"></a><span class="co">## Define network layout</span></span>
<span id="cb92-5"><a href="msea.html#cb92-5"></a>mymat &lt;-<span class="st"> </span>bipartite_tbl</span>
<span id="cb92-6"><a href="msea.html#cb92-6"></a>coordP &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rep</span>(<span class="dv">2</span>, <span class="kw">dim</span>(mymat)[<span class="dv">1</span>]), <span class="kw">seq</span>(<span class="dv">1</span>, <span class="kw">dim</span>(mymat)[<span class="dv">1</span>]) <span class="op">+</span><span class="st"> </span></span>
<span id="cb92-7"><a href="msea.html#cb92-7"></a><span class="st">        </span><span class="dv">2</span>)</span>
<span id="cb92-8"><a href="msea.html#cb92-8"></a>coordA &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rep</span>(<span class="dv">4</span>, <span class="kw">dim</span>(mymat)[<span class="dv">2</span>]), <span class="kw">seq</span>(<span class="dv">1</span>, <span class="kw">dim</span>(mymat)[<span class="dv">2</span>]) <span class="op">+</span><span class="st"> </span></span>
<span id="cb92-9"><a href="msea.html#cb92-9"></a><span class="st">        </span><span class="dv">2</span>)</span>
<span id="cb92-10"><a href="msea.html#cb92-10"></a></span>
<span id="cb92-11"><a href="msea.html#cb92-11"></a>mylayout &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">rbind</span>(coordP, coordA))</span>
<span id="cb92-12"><a href="msea.html#cb92-12"></a></span>
<span id="cb92-13"><a href="msea.html#cb92-13"></a><span class="co">## Construct network content</span></span>
<span id="cb92-14"><a href="msea.html#cb92-14"></a>test.net &lt;-<span class="st"> </span><span class="kw">bip_init_network</span>(mymat, <span class="dt">mode1 =</span> <span class="st">&#39;HumanGenes&#39;</span>,<span class="dt">mode2 =</span> <span class="st">&#39;MicrobialGenus&#39;</span>)</span>
<span id="cb92-15"><a href="msea.html#cb92-15"></a></span>
<span id="cb92-16"><a href="msea.html#cb92-16"></a><span class="co"># Define groups of network nodes</span></span>
<span id="cb92-17"><a href="msea.html#cb92-17"></a>test.net <span class="op">%v%</span><span class="st"> &quot;Group&quot;</span> =<span class="st"> </span><span class="kw">get.vertex.attribute</span>(test.net, <span class="dt">attrname=</span><span class="st">&quot;mode&quot;</span>)</span>
<span id="cb92-18"><a href="msea.html#cb92-18"></a></span>
<span id="cb92-19"><a href="msea.html#cb92-19"></a><span class="co"># Draw network</span></span>
<span id="cb92-20"><a href="msea.html#cb92-20"></a>p &lt;-<span class="st"> </span>GGally<span class="op">::</span><span class="kw">ggnet2</span>(test.net, <span class="dt">mode =</span> mylayout,</span>
<span id="cb92-21"><a href="msea.html#cb92-21"></a>               <span class="dt">label =</span> T, <span class="dt">size =</span> <span class="st">&quot;degree&quot;</span>, <span class="dt">weight =</span> <span class="st">&#39;degree&#39;</span>,</span>
<span id="cb92-22"><a href="msea.html#cb92-22"></a>               <span class="dt">color =</span> <span class="st">&#39;Group&#39;</span>, <span class="dt">shape =</span> <span class="st">&#39;Group&#39;</span>,</span>
<span id="cb92-23"><a href="msea.html#cb92-23"></a>               <span class="dt">label.size =</span> <span class="dv">5</span>, <span class="dt">layout.exp =</span> <span class="fl">1.5</span>, <span class="dt">alpha =</span> <span class="fl">0.75</span>) <span class="op">+</span></span>
<span id="cb92-24"><a href="msea.html#cb92-24"></a><span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;FantasticFox1&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb92-25"><a href="msea.html#cb92-25"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">color=</span><span class="kw">guide_legend</span>(<span class="st">&quot;Group&quot;</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">size =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb92-26"><a href="msea.html#cb92-26"></a></span>
<span id="cb92-27"><a href="msea.html#cb92-27"></a>p</span></code></pre></div>
<p><img src="Function-standard-analysis-workflow_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functional-analysis-of-targetdatabase.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/XbiomeAnalysis/FunctionAnalysis/blob/main/06-Functional_Analysis_MSEA.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Function standard analysis workflow.pdf", "Function standard analysis workflow.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
